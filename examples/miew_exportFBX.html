<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Miew via Global</title>

  <link rel="stylesheet" href="../dist/Miew.min.css">
  <script src="https://unpkg.com/@babel/polyfill@7/dist/polyfill.min.js"></script>
  <script src="../dist/Miew.js"></script>
</head>
<body>
  <h1>Use Miew via browser globals</h1>
  <div class="miew-container" style="width:640px; height:480px"></div>

  <script>
    (function() {
      var viewer = new Miew({
        container: document.getElementsByClassName('miew-container')[0],
        settings: {
          zSprites: false,
          resolution: 'poor',
          }
      });

      const molecules = ['pdb:1CRN', /* Simple molecule */
                        'pdb:1AID', /* Middle ground */
                        'pdb:5B40']; /* Complex molecule */
      const repModes = ['BS', 'VW', 'LC', 'SA', 'SE', 'QS', 'CS', 'TR', 'TU', 'CA'];

      function loadMoleculeSaveFBX(moleculeID) {
        const reprList = [];
        viewer.load(moleculeID).then( () => {
          for(let j = 0; j < repModes.length + 1; ++j) { /* +1 will give us undefined but will start last exporting.*/
            const representation = {
              mode: repModes[j],
              colorer: 'EL',
            };
            reprList[j] = representation;
             /* (async () => {
              viewer.rep(reprList[j]);
              const data = await viewer.rebuild();
              viewer.save({ fileType: 'fbx' });
            })(); */

            setTimeout(() => {
              viewer.rep(reprList[j]);
              viewer.rebuild();
              setTimeout(() => viewer.save({ fileType: 'fbx' }), j * 1000);
            }, j * 2000);
          }
        });
        viewer.unload();
      }

      if (viewer.init()) {
        viewer.run();
        loadMoleculeSaveFBX('pdb:1CRN');
      }
    })();
  </script>
</body>
</html>
